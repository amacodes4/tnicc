



<!DOCTYPE html>
<html lang="en">

    <head>
        
        <meta charset="UTF-8">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Dashboard</title>

        <!-- STYLESHEETS -->
        <style type="text/css">
            [fuse-cloak],
            .fuse-cloak {
                display: none !important;
            }
        </style>

        <!-- Icons.css -->
        <link type="text/css" rel="stylesheet" href="/public/assets/icons/fuse-icon-font/style.css">

        <!-- Animate.css -->
        <link type="text/css" rel="stylesheet" href="/public/assets/vendor/animate.css/animate.min.css">

        <!-- PNotify -->
        <link type="text/css" rel="stylesheet" href="/public/assets/vendor/pnotify/pnotify.custom.min.css">

        <!-- Nvd3 - D3 Charts -->
        <link type="text/css" rel="stylesheet" href="/public/assets/vendor/nvd3/build/nv.d3.min.css"/>

        <!-- Perfect Scrollbar -->
        <link type="text/css" rel="stylesheet" href="/public/assets/vendor/perfect-scrollbar/css/perfect-scrollbar.min.css"/>

        <!-- Fuse Html -->
        <link type="text/css" rel="stylesheet" href="/public/assets/vendor/fuse-html/fuse-html.min.css"/>

        <!-- Main CSS -->
        <!-- / STYLESHEETS -->
        <link type="text/css" rel="stylesheet" href="/public/assets/css/main.css">

        <!-- / JAVASCRIPT -->
        <style>
        /* Style the form */
            #regForm {
            background-color: #ffffff;
            margin: 100px auto;
            padding: 40px;
            width: 70%;
            min-width: 300px;
            }

            /* Style the input fields */
            input {
            padding: 10px;
            width: 100%;
            font-size: 17px;
            font-family: Raleway;
            border: 1px solid #aaaaaa;
            }

            /* Mark input boxes that gets an error on validation: */
            input.invalid {
            background-color: #ffdddd;
            }

            /* Hide all steps by default: */
            .tab {
            display: none;
            }

            /* Make circles that indicate the steps of the form: */
            .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
            }

            /* Mark the active step: */
            .step.active {
            opacity: 1;
            }

            /* Mark the steps that are finished and valid: */
            .step.finish {
            background-color: #4CAF50;
            }
        </style>
    </head>

    <body class="layout layout-vertical layout-left-navigation layout-below-toolbar">

        
        

<div id="wrapper">


    
<aside id="aside" class="aside aside-left"
    data-fuse-bar="aside" data-fuse-bar-media-step="md"
    data-fuse-bar-position="left">
 <div class="aside-content-wrapper">

<div class="aside-content bg-white text-auto">

<div class="aside-toolbar">

 <div class="logo">
     <img src="/public/assets/ldn/images/logo.png">
 </div>

 <button id="toggle-fold-aside-button" type="button" class="btn btn-icon d-none d-lg-block"
         data-fuse-aside-toggle-fold>
     <i class="icon icon-backburger"></i>
 </button>

</div>

<ul class="nav flex-column custom-scrollbar" id="sidenav" data-children=".nav-item">

<li class="nav-item" role="tab" id="heading-dashboards">

<a class="nav-link ripple "
data-toggle="collapse"
data-target="#collapse-dashboards"
href="/admin/dashboard"
aria-expanded="true"
aria-controls="collapse-dashboards">
<i class="icon s-4 icon-tile-four"></i>
<span>Dashboard</span>
</a>     
</ul>
</li>
<li class="nav-item">
   <a class="nav-link ripple " href="#"
    data-page-url="">
    <i class="icon s-4 icon-calendar-today"></i>
    <span>Manage Teams</span>
    </a>
</li>
<li class="nav-item">
    <a class="nav-link ripple " href="/admin/languages"
    data-page-url="">
    <i class="icon s-4 icon-calendar-today"></i>
    <span>Manage Languages</span>
    </a>
</li>
<li class="nav-item">
    <a class="nav-link ripple " href="#"
    data-page-url="">
    <i class="icon s-4 icon-calendar-today"></i>
    <span>Manage Translations</span>
    </a>
</li>

<li class="nav-item">
<a class="nav-link ripple " href="/admin/distributions"
data-page-url="">
<i class="icon s-4 icon-group"></i>
<span>Manage Distributions</span>
</a>
</li>

<li class="nav-item">
<a class="nav-link ripple " href="/admin/distributors/"
data-page-url="">
<i class="icon s-4 icon-people"></i>
<span>Manage Distributors</span>
</a>
</li>

<li class="nav-item">
    <a class="nav-link ripple " href="/admin/payments"
        data-page-url="">
        <i class="icon s-4 icon-cash"></i>
        <span>Manage Payments</span>
    </a>
</li>
</ul>
</div>
</div>
</aside>



    <div class="content-wrapper">

        
            <nav id="toolbar" class="fixed-top bg-white">

    <div class="row no-gutters align-items-center flex-nowrap">

        <div class="col">

            <div class="row no-gutters align-items-center flex-nowrap">

                

                    <button type="button" class="toggle-aside-button btn btn-icon d-block d-lg-none"
                            data-fuse-bar-toggle="aside">
                        <i class="icon icon-menu"></i>
                    </button>

                    <div class="toolbar-separator d-block d-lg-none"></div>

                


                <div class="shortcuts-wrapper row no-gutters align-items-center px-0 px-sm-2">

                    <div class="shortcuts row no-gutters align-items-center d-none d-md-flex">
                    </div>

                    <div class="add-shortcut-menu-button dropdown px-1 px-sm-3">

                    </div>
                </div>

            </div>
        </div>

        <div class="col-auto">

            <div class="row no-gutters align-items-center justify-content-end">

                <div class="user-menu-button dropdown">

                    <div class="dropdown-toggle ripple row align-items-center no-gutters px-2 px-sm-4" role="button"
                         id="dropdownUserMenu"
                         data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="avatar-wrapper">
                            <img class="avatar" src="/public/assets/images/avatars/profile.jpg">
                            <i class="status text-green icon-checkbox-marked-circle s-4"></i>
                        </div>
                        <span class="username mx-3 d-none d-md-block">Super Admin</span>
                    </div>

                    <div class="dropdown-menu" aria-labelledby="dropdownUserMenu">

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <i class="icon-account"></i>
                                <span class="px-3">My Profile</span>
                            </div>
                        </a>

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <i class="icon-email"></i>
                                <span class="px-3">Inbox</span>
                            </div>
                        </a>

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <i class="status text-green icon-checkbox-marked-circle"></i>
                                <span class="px-3">Online</span>
                            </div>
                        </a>

                        <div class="dropdown-divider"></div>

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <i class="icon-logout"></i>
                                <span class="px-3">Logout</span>
                            </div>
                        </a>

                    </div>
                </div>

                <div class="toolbar-separator"></div>

                <div class="toolbar-separator"></div>

                <div class="language-button dropdown">

                    <div
                        class="dropdown-toggle ripple row align-items-center justify-content-center no-gutters px-0 px-sm-4"
                        role="button"
                        id="dropdownLanguageMenu"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <div class="row no-gutters align-items-center">
                            <img class="flag mr-2" src="/public/assets/images/flags/us.png">
                            <span class="d-none d-md-block">EN</span>
                        </div>
                    </div>

                    <div class="dropdown-menu" aria-labelledby="dropdownLanguageMenu">

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <img class="flag" src="/public/assets/images/flags/us.png">
                                <span class="px-3">English</span>
                            </div>
                        </a>

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <img class="flag" src="/public/assets/images/flags/es.png">
                                <span class="px-3">Spanish</span>
                            </div>
                        </a>

                        <a class="dropdown-item" href="#">
                            <div class="row no-gutters align-items-center flex-nowrap">
                                <img class="flag" src="/public/assets/images/flags/tr.png">
                                <span class="px-3">Turkish</span>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="toolbar-separator"></div>


                

            </div>
        </div>
    </div>
</nav>
        

        <div class="content">
            <div id="project-dashboard" class="page-layout simple right-sidebar tabbed">

    <div class="page-content-wrapper">

        <!-- HEADER -->
        <div class="page-header bg-secondary text-auto d-flex flex-column justify-content-between px-6 pt-4 pb-0">

            <div class="row no-gutters align-items-start justify-content-between flex-nowrap">

                <div>
                    <span class="h2">Rhapsody of Realities Translations</span>
                </div>

                <div>
                     <a class="pull-right h6 text-white" href="https://firebasestorage.googleapis.com/v0/b/tnicc-412a9.appspot.com/o/translations-template.csv?alt=media&token=e9f5fb42-aafd-4efb-aa65-1834522cd961">Download Bulk Upload Template</a>
                </div>
                <button type="button" class="sidebar-toggle-button btn btn-icon d-block d-xl-none"
                        data-fuse-bar-toggle="dashboard-project-sidebar" aria-label="Toggle sidebar">
                    <i class="icon icon-menu"></i>
                </button>
            </div>

        </div>
        <!-- / HEADER -->

        <!-- CONTENT -->
        <div class="page-content pl-2">
            <div class="tab-content">
        <!-- WIDGET 4 -->
        <div class="col-lg-12 col-sm-12">

                <div class="widget widget4 card">

                    <form id="regForm" action="">

                    <h1>Bulk Upload Translations:</h1>
                    
                    <!-- One "tab" for each step in the form: -->
                    <div class="tab">CSV Template:
                    <div class="custom-file">
                        <input type="file" class="custom-file-input submit-button btn btn-block btn-default my-4 mx-auto" id="translationCSV" oninput="this.className = ''">
                        <label class="custom-file-label" for="translationCSV">Choose file</label>
                        <div class="list-group" id="translationListView">

                        </div>
                      </div>
                    </div>
                    
                    <div class="tab">Month & Year of Translation:
                        <div class="form-group">
                            <select class="form-control custom-select"  id="month">
                                <option selected value="">Select Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                             </select>
                         </div>
                         <div class="form-group">
                            <input type="number" class="form-control" id="year"  oninput="this.className = ''"  placeholder="Year">
                         </div>
                    </div>
                    <div class="tab">Translation Documents:
                        <div class="custom-file">
                            <input type="file"  class="custom-file-input submit-button btn btn-block btn-default my-4 mx-auto" id="translationPDF" oninput="this.className = ''" multiple  onchange="processFiles()">
                            <label class="custom-file-label" for="translationPDF">Choose file</label>
                          </div>

                        <div class="list-group" id="pdfListView">

                          </div>
                    </div>
                    <div class="tab">Summary:
                    <p><input placeholder="Username..." oninput="this.className = ''"></p>
                    <p><input placeholder="Password..." oninput="this.className = ''"></p>
                    </div>
                    
                    <div style="overflow:auto;">
                    <div style="float:right;">
                        <button type="button" id="prevBtn" class="submit-button btn btn-block btn-warning my-4 mx-auto" onclick="nextPrev(-1)">Previous</button>
                        <button type="button" id="nextBtn" class="submit-button btn btn-block btn-secondary my-4 mx-auto" onclick="nextPrev(1)">Next</button>
                    </div>
                    </div>
                    
                    <!-- Circles which indicates the steps of the form: -->
                    <div style="text-align:center;margin-top:40px;">
                    <span class="step"></span>
                    <span class="step"></span>
                    <span class="step"></span>
                    <span class="step"></span>
                    </div>
                    
                    </form>
                    </div>

            </div>
        </div>
</div>
 

           </div>
    <!-- / WIDGET GROUP -->
</div>
         </div>
</div>
</div>
    </div>
        <!-- / CONTENT -->
    </div>    
    </div>

</div>

        <!-- JAVASCRIPT -->

        <!-- jQuery -->
        <script type="text/javascript" src="/public/assets/js/jquery.min.js"></script>

        <!-- Mobile Detect -->
        <script type="text/javascript" src="/public/assets/vendor/mobile-detect/mobile-detect.min.js"></script>

        <!-- Perfect Scrollbar -->
        <script type="text/javascript"
                src="/public/assets/vendor/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js"></script>

        <!-- Popper.js -->
        <script type="text/javascript" src="/public/assets/vendor/popper.js/index.js"></script>

        <!-- Bootstrap -->
        <script type="text/javascript" src="/public/assets/vendor/bootstrap/bootstrap.min.js"></script>

        <!-- Nvd3 - D3 Charts -->
        <script type="text/javascript" src="/public/assets/vendor/d3/d3.min.js"></script>
        <script type="text/javascript" src="/public/assets/vendor/nvd3/build/nv.d3.min.js"></script>

        <!-- Data tables -->
        <script type="text/javascript" src="/public/assets/vendor/datatables.net/js/jquery.dataTables.min.js"></script>

        <script type="text/javascript" src="/public/assets/vendor/datatables-responsive/js/dataTables.responsive.js"></script>

        <!-- PNotify -->
        <script type="text/javascript" src="/public/assets/vendor/pnotify/pnotify.custom.min.js"></script>

        <!-- Fuse Html -->
        <script type="text/javascript" src="/public/assets/vendor/fuse-html/fuse-html.min.js"></script>

        <!-- Main JS -->
        <script type="text/javascript" src="/public/assets/js/main.js"></script>
        <script type="text/javascript" src="/public/assets/js/custom/Translations.js"></script>
        <script type="text/javascript" src="/public/assets/js/shim.min.js"></script>
         <script type="text/javascript" src="/public/assets/js/xlsx.full.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-app.js"></script> 
<!-- Add Firebase products that you want to use -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/7.9.1/modernizr.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-storage.js"></script>
<script type="text/javascript" src="/public/assets/js/custom/Languages.js"></script>

<!-- The core Firebase JS SDK is always required and must be listed first -->

<script>

$(document).ready(function(){
    const csvEl = document.getElementById("translationCSV");
    csvEl.addEventListener("change", handleFiles, false);


    Languages.loadLanguages('/dept/admin/tni/language/').then(function(data){
    var ele = document.getElementById('language');
    for (var i = 0; i < data.length; i++) {
        // POPULATE SELECT ELEMENT WITH JSON.
        ele.innerHTML = ele.innerHTML +
            '<option value="' + data[i]['_id'] + '">' + data[i]['name'] + '</option>';
    }
   });


});
function create_UUID(){
            var dt = new Date().getTime();
            var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = (dt + Math.random()*16)%16 | 0;
                dt = Math.floor(dt/16);
                return (c=='x' ? r :(r&0x3|0x8)).toString(16);
            });
            return uuid;
    }
    function selectFileName(input) {
        if (input.files && input.files[0]) {
            $("#filename").text(input.files[0].name);
        }
    }
</script>
<script>
var currentTab = 0; // Current tab is set to be the first tab (0)
showTab(currentTab); // Display the current tab

function showTab(n) {
  // This function will display the specified tab of the form ...
  var x = document.getElementsByClassName("tab");
  x[n].style.display = "block";
  // ... and fix the Previous/Next buttons:
  if (n == 0) {
    document.getElementById("prevBtn").style.display = "none";
  } else {
    document.getElementById("prevBtn").style.display = "inline";
  }
  if (n == (x.length - 1)) {
    document.getElementById("nextBtn").innerHTML = "Submit";
  } else {
    document.getElementById("nextBtn").innerHTML = "Next";
  }
  // ... and run a function that displays the correct step indicator:
  fixStepIndicator(n)
}

function nextPrev(n) {
  // This function will figure out which tab to display
  var x = document.getElementsByClassName("tab");
  // Exit the function if any field in the current tab is invalid:
  if (n == 1 && !validateForm()) return false;
  // Hide the current tab:
  x[currentTab].style.display = "none";
  // Increase or decrease the current tab by 1:
  currentTab = currentTab + n;
  // if you have reached the end of the form... :
  if (currentTab >= x.length) {
    //...the form gets submitted:
    document.getElementById("regForm").submit();
    return false;
  }
  // Otherwise, display the correct tab:
  showTab(currentTab);
}

function validateForm() {
  // This function deals with validation of the form fields
  var x, y, i, valid = true;
  x = document.getElementsByClassName("tab");
  y = x[currentTab].getElementsByTagName("input");
  // A loop that checks every input field in the current tab:
  for (i = 0; i < y.length; i++) {
    // If a field is empty...
    if (y[i].value == "") {
      // add an "invalid" class to the field:
      y[i].className += " invalid";
      // and set the current valid status to false:
      valid = false;
    }
  }
  // If the valid status is true, mark the step as finished and valid:
  if (valid) {
    document.getElementsByClassName("step")[currentTab].className += " finish";
  }
  return valid; // return the valid status
}

function fixStepIndicator(n) {
  // This function removes the "active" class of all steps...
  var i, x = document.getElementsByClassName("step");
  for (i = 0; i < x.length; i++) {
    x[i].className = x[i].className.replace(" active", "");
  }
  //... and adds the "active" class to the current step:
  x[n].className += " active";
}

</script>

<script>
     function handlePDFFiles() { 
        if (!this.files.length)
          return;
        let pdfs =   onFilePicked(this.files);
        console.log(JSON.stringify(pdfs))
             
      }
     function handleFiles() { 
        if (!this.files.length)
          return;
        processExcel(this.files[0]);
             

      }

     function processExcel(file) {
        var reader = new FileReader();
        let translationsList = [];
        reader.onload = (e) => {
          var data = new Uint8Array(e.target.result);
          var workbook = XLSX.read(data, {type: 'array'});
          var first_sheet_name = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[first_sheet_name];
          let arrayOfRows = XLSX.utils.sheet_to_json(worksheet, {header: 1})
          			

          for(var i = 1; i<= arrayOfRows.length -1; i++) {
            if (typeof arrayOfRows[i][0] !== 'undefined'){
            let translationRecord = {
                language: `${arrayOfRows[i][0]}`,
                docType: `${arrayOfRows[i][1]}`,
                fileName: `${arrayOfRows[i][2]}`
            };
            translationsList.push(translationRecord);
            }
          }
        let ul = $('#translationListView');

        for(var i = 0; i < translationsList.length; i++){ 
            let listItem = $(`<a href="#" class="list-group-item list-group-item-action active download-link">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1 language"></h5>
                                    <small class="doc-type"></small>
                                </div>
                                <small class="file"></small>
                                </a>`);
                $(listItem).find(".language").text(translationsList[i].language);
                $(listItem).find(".doc-type").text(translationsList[i].docType);
                $(listItem).find(".file").text(translationsList[i].fileName);

                $(ul).append($(listItem));
           }         
        };
        reader.readAsArrayBuffer(file);

        Translations.setTranslations(translationsList);
      }
      function processPDF(file) {
        var reader = new FileReader();
        let translationsList = [];
        reader.onload = (e) => {
          var data = new Uint8Array(e.target.result);
          var workbook = XLSX.read(data, {type: 'array'});
          var first_sheet_name = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[first_sheet_name];
          let arrayOfRows = XLSX.utils.sheet_to_json(worksheet, {header: 1})
          			

          for(var i = 1; i<= arrayOfRows.length -1; i++) {
            if (typeof arrayOfRows[i][0] !== 'undefined'){
            let translationRecord = {
                language: `${arrayOfRows[i][0]}`,
                docType: `${arrayOfRows[i][1]}`,
                fileName: `${arrayOfRows[i][2]}`
            };
            translationsList.push(translationRecord);
            }
          }
        let ul = $('#translationListView');

        for(var i = 0; i < translationsList.length; i++){ 
            let listItem = $(`<a href="#" class="list-group-item list-group-item-action active download-link">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1 language"></h5>
                                    <small class="doc-type"></small>
                                </div>
                                <small class="file"></small>
                                </a>`);
                $(listItem).find(".language").text(translationsList[i].language);
                $(listItem).find(".doc-type").text(translationsList[i].docType);
                $(listItem).find(".file").text(translationsList[i].fileName);

                $(ul).append($(listItem));
           }         
        };
        reader.readAsArrayBuffer(file);

        return translationsList;
      }
      let translationPDFList =  [];

      function processFiles()
        {
            var firebaseConfig = {
                            apiKey: "AIzaSyDEQPLbNYogRPr0G47ErxqkGP6VCMvakvI",
                            authDomain: "tnicc-412a9.firebaseapp.com",
                            databaseURL: "https://tnicc-412a9.firebaseio.com",
                            projectId: "tnicc-412a9",
                            storageBucket: "tnicc-412a9.appspot.com",
                            messagingSenderId: "1021374360464",
                            appId: "1:1021374360464:web:5d7f9a0230f14f1d442115",
                            measurementId: "G-T1GRXX01CV"
                        };
                 firebase.initializeApp(firebaseConfig);  

            var filelist = document.getElementById('translationPDF').files;
            for(var i=0; i<filelist.length; i++)

            {

                writefiles(filelist[i]);

            }

        }



    function writefiles(file)

    {

        var reader = new FileReader();

        reader.onload = function()

        {
           // translationPDFList.push({name:file.name,file:reader.result});
          //  console.log(file.name);
          // document.getElementById('output').innerText += reader.result;


                  
                 //   let filename = image.name 
                    const metadata = { contentType: file.type };
                    console.log('translations[i].fileName',file.name );
                    const task = firebase.app().storage().ref('docs/'+file.name).put(file, metadata); 
                    task.then(snapshot => snapshot.ref.getDownloadURL()).then(function(url) { 
                      let translations = Translations.getTranslations();
                      console.log('translations',JSON.stringify(translations))
                      for(var i = 0; i < translations.length; i++){

                        console.log('translations[i].fileName',translations[i].fileName );
                        
                        if(translations[i].fileName == file.name){
                            let upload = {
                                language: translations[i].language,
                                month: document.getElementById("month").value,
                                year: document.getElementById("year").value,
                                docType: translations[i].docType,
                                dataURL: url
                                }
                            Translations.uploadTranslation('/dept/admin/tni/translation/create',upload).then(function (data){
                                var json = JSON.stringify(data); 
                                console.log("json",json);
                            })
                        }
                         
                      }

                   // document.getElementById("photo").src = url; 
                });  


        }

        reader.readAsDataURL(file);

    }

</script>
</body>
</html>
